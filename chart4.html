<!DOCTYPE html>
<html>
<head>
  <!-- Plotly.js -->
  <script src="lib\plotly-2.27.0.min.js"></script>
</head>
<body>
  <script type="text/javascript" src="webapp/lib/d3.v5.min.js"></script>
  <script type="text/javascript" src="webapp/lib/d3-tip.min.js"></script>
  <script type="text/javascript" src='webapp/lib/plotly.min.js'></script>
  <script>
    // Function to process the CSV data
    function processData(csvData, selectedArtist) {
      const rows = csvData.split('\n');
      const hotnessByYear = {};

      for (let i = 1; i < rows.length; i++) {
        const values = rows[i].split(',');
        const artist = values[12];
        const hotness = parseFloat(values[7]);
        const year = parseInt(values[53]);

        if (artist === selectedArtist && !isNaN(hotness) && !isNaN(year)) {
          if (!hotnessByYear[year]) {
            hotnessByYear[year] = [];
          }
          hotnessByYear[year].push(hotness);
        }
      }

      // Calculate average hotness for each year
      const averageHotnessByYear = Object.keys(hotnessByYear).map(year => {
        const hotnessValues = hotnessByYear[year];
        const averageHotness = hotnessValues.reduce((sum, val) => sum + val, 0) / hotnessValues.length;
        return { year: parseInt(year), averageHotness };
      });

      return averageHotnessByYear;
    }

    // Fetch the CSV file
    fetch('webapp/data/song_genre_year.csv')
      .then(response => response.text())
      .then(csvData => {
        const artists = new Set();
        const rows = csvData.split('\n');
        for (let i = 1; i < rows.length; i++) {
          const values = rows[i].split(',');
          artists.add(values[12]);
        }

        const artistDropdown = document.getElementById('artistDropdown');
        artists.forEach(artist => {
          const option = document.createElement('option');
          option.value = artist;
          option.text = artist;
          artistDropdown.appendChild(option);
        });

        artistDropdown.addEventListener('change', function () {
          const selectedArtist = this.value;
          const processedData = processData(csvData, selectedArtist);

          const trace = {
            x: processedData.map(item => item.year),
            y: processedData.map(item => item.averageHotness),
            mode: 'lines+markers',
            type: 'scatter',
            name: selectedArtist,
          };

          const layout = {
            title: `Average Hotness for ${selectedArtist}`,
            xaxis: { title: 'Year' },
            yaxis: { title: 'Average Hotness' },
          };

          const data = [trace];
          Plotly.newPlot('linechart', data, layout);
        });

        const firstArtist = artistDropdown.options[0].value;
        const initialData = processData(csvData, firstArtist);

        const trace = {
          x: initialData.map(item => item.year),
          y: initialData.map(item => item.averageHotness),
          mode: 'lines+markers',
          type: 'scatter',
          name: firstArtist,
        };

        const layout = {
          title: `Average Hotness for ${firstArtist}`,
          xaxis: { title: 'Year' },
          yaxis: { title: 'Average Hotness' },
        };

        const data = [trace];
        Plotly.newPlot('linechart', data, layout);
      });
  </script>
</body>
</html>
